<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Instant Photo Print</title>
    <link rel="stylesheet" href="styles.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css"
    />
    <style>
      body {
        font-family: Arial, sans-serif;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
        background-color: #f4f4f4;
      }

      .container {
        text-align: center;
        overflow: scroll;
      }

      .canvas-container {
        position: relative;
      }

      #canvas {
        border: 1px solid #ccc;
        margin-top: 20px;
      }

      .controls {
        margin-top: 20px;
      }

      .controls label,
      .controls input {
        display: block;
        margin: 10px 0;
      }

      .controls button {
        padding: 10px 20px;
        font-size: 16px;
        margin: 10px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Instant Photo Print</h1>
      <input type="file" id="upload" accept="image/*" />
      <div class="canvas-container">
        <canvas id="canvas"></canvas>
      </div>
      <div class="controls">
        <!-- <label for="saturation">Saturation</label>
        <input
          type="range"
          id="saturation"
          min="0"
          max="2"
          step="0.1"
          value="1"
        />

        <label for="sharpness">Sharpness</label>
        <input
          type="range"
          id="sharpness"
          min="0"
          max="2"
          step="0.1"
          value="1"
        />

        <label for="redEye">Red-Eye Reduction</label>
        <input type="checkbox" id="redEye" />

        <label for="colorBalance">Color Balance</label>
        <input
          type="range"
          id="colorBalance"
          min="0"
          max="2"
          step="0.1"
          value="1"
        /> -->

        <img id="image" style="display: none" />
        <button id="cropButton">Crop Image</button>
      </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
    <script>
      const upload = document.getElementById("upload");
      const canvas = document.getElementById("canvas");
      const ctx = canvas.getContext("2d");
      const image = document.getElementById("image");

      //   const saturationInput = document.getElementById("saturation");
      //   const sharpnessInput = document.getElementById("sharpness");
      //   const redEyeInput = document.getElementById("redEye");
      //   const colorBalanceInput = document.getElementById("colorBalance");
      const cropButton = document.getElementById("cropButton");

      let originalImageData;
      let cropper;

      upload.addEventListener("change", (event) => {
        const file = event.target.files[0];
        const reader = new FileReader();
        reader.onload = (e) => {
          image.src = e.target.result;
          image.style.display = "block";
          image.onload = () => {
            if (cropper) {
              cropper.destroy();
            }
            cropper = new Cropper(image, {
              aspectRatio: NaN,
              viewMode: 1,
              ready: () => {
                canvas.width = image.width;
                canvas.height = image.height;
                ctx.drawImage(image, 0, 0);
                originalImageData = ctx.getImageData(
                  0,
                  0,
                  canvas.width,
                  canvas.height
                );
              },
            });
          };
        };
        reader.readAsDataURL(file);
      });

      //   const applyEdits = () => {
      //     ctx.putImageData(originalImageData, 0, 0);
      //     let imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
      //     applySaturation(imageData);
      //     applySharpness(imageData);
      //     applyRedEyeReduction(imageData);
      //     applyColorBalance(imageData);
      //     ctx.putImageData(imageData, 0, 0);
      //   };

      //   saturationInput.addEventListener("input", applyEdits);
      //   sharpnessInput.addEventListener("input", applyEdits);
      //   redEyeInput.addEventListener("change", applyEdits);
      //   colorBalanceInput.addEventListener("input", applyEdits);

      cropButton.addEventListener("click", () => {
        if (cropper) {
          const croppedCanvas = cropper.getCroppedCanvas();
          canvas.width = croppedCanvas.width;
          canvas.height = croppedCanvas.height;
          ctx.drawImage(croppedCanvas, 0, 0);
          originalImageData = ctx.getImageData(
            0,
            0,
            canvas.width,
            canvas.height
          );
          cropper.destroy();
          image.style.display = "none";
        }
      });

      //   function applySaturation(imageData) {
      //     const saturation = parseFloat(saturationInput.value);
      //     const data = imageData.data;
      //     for (let i = 0; i < data.length; i += 4) {
      //       const r = data[i];
      //       const g = data[i + 1];
      //       const b = data[i + 2];
      //       const avg = (r + g + b) / 3;
      //       data[i] = avg + (r - avg) * saturation;
      //       data[i + 1] = avg + (g - avg) * saturation;
      //       data[i + 2] = avg + (b - avg) * saturation;
      //     }
      //   }

      //   function applySharpness(imageData) {
      //     const sharpness = parseFloat(sharpnessInput.value);
      //     const w = imageData.width;
      //     const h = imageData.height;
      //     const weight = sharpness - 1;
      //     const side = Math.round(Math.sqrt(weight));
      //     const halfside = Math.floor(side / 2);
      //     const data = imageData.data;
      //     const src = new Uint8ClampedArray(data);

      //     for (let y = 0; y < h; y++) {
      //       for (let x = 0; x < w; x++) {
      //         const sy = y;
      //         const sx = x;
      //         const dstOff = (y * w + x) * 4;
      //         let r = 0,
      //           g = 0,
      //           b = 0;
      //         for (let cy = 0; cy < side; cy++) {
      //           for (let cx = 0; cx < side; cx++) {
      //             const scy = Math.min(h - 1, Math.max(0, sy + cy - halfside));
      //             const scx = Math.min(w - 1, Math.max(0, sx + cx - halfside));
      //             const srcOff = (scy * w + scx) * 4;
      //             const wt = weight / (side * side);
      //             r += src[srcOff] * wt;
      //             g += src[srcOff + 1] * wt;
      //             b += src[srcOff + 2] * wt;
      //           }
      //         }
      //         data[dstOff] = r;
      //         data[dstOff + 1] = g;
      //         data[dstOff + 2] = b;
      //       }
      //     }
      //   }

      //   function applyRedEyeReduction(imageData) {
      //     if (redEyeInput.checked) {
      //       const data = imageData.data;
      //       for (let i = 0; i < data.length; i += 4) {
      //         if (data[i] > 150 && data[i + 1] < 80 && data[i + 2] < 80) {
      //           data[i] =
      //             data[i + 1] =
      //             data[i + 2] =
      //               (data[i] + data[i + 1] + data[i + 2]) / 3;
      //         }
      //       }
      //     }
      //   }

      //   function applyColorBalance(imageData) {
      //     const colorBalance = parseFloat(colorBalanceInput.value);
      //     const data = imageData.data;
      //     for (let i = 0; i < data.length; i += 4) {
      //       data[i] *= colorBalance;
      //       data[i + 1] *= colorBalance;
      //       data[i + 2] *= colorBalance;
      //     }
      //   }
    </script>
  </body>
</html>
